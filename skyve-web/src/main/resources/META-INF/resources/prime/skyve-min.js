SKYVE={};SKYVE.Util=function(){var a=window.location+"";a=a.substring(0,a.lastIndexOf("/")+1);return{customer:null,v:null,googleMapsV3ApiKey:null,ckEditorConfigFileUrl:null,mapCentre:null,mapZoom:1,CONTEXT_URL:a,loadJS:function(c,e){var b=document.createElement("SCRIPT");b.type="text/javascript";b.src=c;if(e!=null){if(b.readyState){b.onreadystatechange=function(){if(b.readyState=="loaded"||b.readyState=="complete"){b.onreadystatechange=null;e()}}}else{b.onload=e}}var d=document.getElementsByTagName("HEAD");if(d[0]!=null){d[0].appendChild(b)}},geoLocate:function(b){if(navigator.geolocation){$(function(){PrimeFaces.cw("Growl","growl",{id:"growl",widgetVar:"growl",msgs:[{summary:"GeoLocating",detail:"Please wait...",severity:"info"}]})});navigator.geolocation.getCurrentPosition(function(c){$(function(){PrimeFaces.cw("Growl","growl",{id:"growl",widgetVar:"growl",msgs:[{summary:"GeoLocating",detail:"Done",severity:"info"}]})});b("POINT ("+c.coords.longitude+" "+c.coords.latitude+")")},function(c){$(function(){PrimeFaces.cw("Growl","growl",{id:"growl",widgetVar:"growl",msgs:[{summary:"GeoLocating",detail:c.message,severity:"warn"}]})})},{enableHighAccuracy:true})}}}}();SKYVE.GMap=function(){var b=null;var a=function(d){var c=null;if(d=="point"){c=[google.maps.drawing.OverlayType.MARKER]}else{if(d=="line"){c=[google.maps.drawing.OverlayType.POLYLINE]}else{if(d=="polygon"){c=[google.maps.drawing.OverlayType.POLYGON,google.maps.drawing.OverlayType.RECTANGLE]}else{if(d=="pointAndLine"){c=[google.maps.drawing.OverlayType.MARKER,google.maps.drawing.OverlayType.POLYLINE]}else{if(d=="pointAndPolygon"){c=[google.maps.drawing.OverlayType.MARKER,google.maps.drawing.OverlayType.POLYGON,google.maps.drawing.OverlayType.RECTANGLE]}else{if(d=="lineAndPolygon"){c=[google.maps.drawing.OverlayType.POLYLINE,google.maps.drawing.OverlayType.POLYGON,google.maps.drawing.OverlayType.RECTANGLE]}else{c=[google.maps.drawing.OverlayType.MARKER,google.maps.drawing.OverlayType.POLYLINE,google.maps.drawing.OverlayType.POLYGON,google.maps.drawing.OverlayType.RECTANGLE]}}}}}}return c};return{scatter:function(t,C,q,A){if(!b){b=new Wkt.Wkt()}var k=C.items;if(!k){return}if(A){for(var h in t._objects){if(!k.containsProperty("bizId",h)){var z=t._objects[h];for(var v=0,r=z.overlays.length;v<r;v++){z.overlays[v].setMap(null);z.overlays[v]=null}delete z.overlays;delete t._objects[h]}}}else{for(var h in t._objects){var z=t._objects[h];for(var v=0,r=z.overlays.length;v<r;v++){z.overlays[v].setMap(null);z.overlays[v]=null}delete z.overlays;delete t._objects[h]}}for(var v=0,r=k.length;v<r;v++){var y=k[v];var D=t._objects[y.bizId];if(D){var s=(D.overlays.length==y.features.length);if(s){for(var u=0,p=D.overlays.length;u<p;u++){if(D.overlays[u].geometry!==y.features[u].geometry){s=false;break}}}if(!s){for(var u=0,p=D.overlays.length;u<p;u++){D.overlays[u].setMap(null);D.overlays[u]=null}delete D.overlays;delete t._objects[h];D=null}}if(D){}else{D={overlays:[]};for(var u=0,p=y.features.length;u<p;u++){var f=y.features[u];try{b.read(f.geometry)}catch(x){if(x.name==="WKTError"){alert(f.geometry+" is invalid WKT.");continue}}var d={editable:f.editable};if(f.strokeColour){d.strokeColor=f.strokeColour}if(f.fillColour){d.fillColor=f.fillColour}if(f.fillOpacity){d.fillOpacity=f.fillOpacity}if(f.iconDynamicImageName){d.icon={url:SKYVE.Util.CONTEXT_URL+"resources?_n="+f.iconDynamicImageName+"&_doc="+C._doc};if(f.iconAnchorX&&f.iconAnchorY){d.icon.anchor=new google.maps.Point(f.iconAnchorX,f.iconAnchorY);d.icon.origin=new google.maps.Point(0,0)}}var w=b.toObject(d);D.overlays.push(w);w.setMap(t.webmap);if(f.zoomable){w.bizId=y.bizId;w.geometry=f.geometry;w.fromTimestamp=y.fromTimestamp;w.toTimestamp=y.toTimestamp;w.mod=y.moduleName;w.doc=y.documentName;w.infoMarkup=y.infoMarkup;google.maps.event.addListener(w,"click",function(e){t.click(this,e)})}}t._objects[y.bizId]=D}}if(q){var g=new google.maps.LatLngBounds();var c=false;for(var o in t._objects){c=true;var D=t._objects[o];var B=D.overlays;for(var v=0,r=B.length;v<r;v++){var w=B[v];if(w.getPath){var n=w.getPath();for(var u=0,p=n.getLength();u<p;u++){g.extend(n.getAt(u))}}else{if(w.getPosition){g.extend(w.getPosition())}}}}if(c){if(g.getNorthEast().equals(g.getSouthWest())){if(t.webmap.getZoom()<15){t.webmap.setZoom(15)}if(w.getPosition!==undefined&&typeof w.getPosition==="function"){t.webmap.setCenter(g.getNorthEast())}}else{t.webmap.fitBounds(g)}}}},centre:function(){if(!b){b=new Wkt.Wkt()}var c=null;if(SKYVE.Util.mapCentre){try{b.read(SKYVE.Util.mapCentre);var f=b.components[0];c=new google.maps.LatLng(f.y,f.x)}catch(d){console.log(SKYVE.Util.mapCentre+" is malformed WKT Point format");SKYVE.Util.mapCentre=null;c=new google.maps.LatLng(0,0)}}else{c=new google.maps.LatLng(0,0)}return c},scatterValue:function(m,g){if(!b){b=new Wkt.Wkt()}if(!g){return}try{b.read(g)}catch(k){if(k.name==="WKTError"){alert("The WKT string is invalid.");return}}var j=b.toObject(m.webmap.defaults);if(b.type==="polygon"||b.type==="linestring"){}else{if(j.setEditable){j.setEditable(false)}}if(Wkt.isArray(j)){for(d in j){if(j.hasOwnProperty(d)&&(!Wkt.isArray(j[d]))){j[d].setMap(m.webmap);m._overlays.push(j[d])}}}else{j.setMap(m.webmap);m._overlays.push(j)}if(j.getBounds!==undefined&&typeof j.getBounds==="function"){m.webmap.fitBounds(j.getBounds())}else{if(j.getPath!==undefined&&typeof j.getPath==="function"){var f=new google.maps.LatLngBounds();var h=j.getPath();for(var d=0,c=h.getLength();d<c;d++){f.extend(h.getAt(d))}m.webmap.fitBounds(f)}else{if(m.webmap.getZoom()<15){m.webmap.setZoom(15)}if(j.getPosition!==undefined&&typeof j.getPosition==="function"){m.webmap.setCenter(j.getPosition())}}}},clear:function(e){for(var d=0,c=e._overlays.length;d<c;d++){e._overlays[d].setMap(null)}e._overlays.length=0},drawingTools:function(d){if(!b){b=new Wkt.Wkt()}var c={editable:true,strokeColor:"#990000",fillColor:"#EEFFCC",fillOpacity:0.6};d.webmap.drawingManager=new google.maps.drawing.DrawingManager({drawingControlOptions:{position:google.maps.ControlPosition.LEFT_BOTTOM,defaults:c,drawingModes:a(d.drawingTools)},markerOptions:c,polygonOptions:c,polylineOptions:c,rectangleOptions:c});d.webmap.drawingManager.setMap(d.webmap);google.maps.event.addListener(d.webmap.drawingManager,"overlaycomplete",function(f){SKYVE.GMap.clear(d);this.setDrawingMode(null);d._overlays.push(f.overlay);b.fromObject(f.overlay);var e=b.write();d.setFieldValue(e)})},geoLocator:function(d){if(navigator.geolocation){var c=document.createElement("DIV");c.style.backgroundColor="#fff";c.style.border="2px solid #fff";c.style.borderRadius="3px";c.style.boxShadow="0 2px 6px rgba(0,0,0,.3)";c.style.cursor="pointer";c.style.margin="10px";c.style.padding="5px";c.style.textAlign="center";c.title="Click to set you current position from your GPS";c.innerHTML='<i class="fa fa-map-marker fa-2x"></i>';c.index=1;c.addEventListener("click",function(){navigator.geolocation.getCurrentPosition(function(e){SKYVE.GMap.clear(d);d.webmap.setDrawingMode(null);var e={lat:e.coords.latitude,lng:e.coords.longitude};var f=new google.maps.Marker({position:e,map:d.webmap});d.setFieldValue("POINT ("+e.coords.longitude+" "+e.coords.latitude+")");me.webmap.setZoom(15);d.webmap.setCenter(e)},function(e){alert(e.message)},{enableHighAccuracy:true})});d.webmap.controls[google.maps.ControlPosition.LEFT].push(c)}},refreshControls:function(d){var c=document.createElement("DIV");c.style.backgroundColor="#fff";c.style.border="2px solid #fff";c.style.borderRadius="3px";c.style.boxShadow="0 2px 6px rgba(0,0,0,.3)";c.style.cursor="pointer";c.style.margin="10px";c.style.padding="5px";c.style.textAlign="center";c.title="Click to set you current position from your GPS";c.innerHTML='<input type="number" min="1" max="500" step="1" value="'+d.refreshTime+'" size="3" /><input type="checkbox"'+(d._refreshRequired?" checked":"")+"><label>Refresh</label>";c.index=1;c.children[0].addEventListener("change",function(){d.refreshTime=this.value;if(d._refreshRequired){if(d._intervalId){clearInterval(d._intervalId)}d._intervalId=setInterval(d.rerender.bind(d),d.refreshTime*1000)}});c.children[1].addEventListener("click",function(){d._refreshRequired=this.checked;if(d._intervalId){clearInterval(d._intervalId);d._intervalId=null}if(d._refreshRequired){d.rerender();d._intervalId=setInterval(d.rerender.bind(d),d.refreshTime*1000)}});d.webmap.controls[google.maps.ControlPosition.LEFT_BOTTOM].push(c)}}}();SKYVE.PF=function(){var a=false;return{getById:function(b){return $(PrimeFaces.escapeClientId(b))},getByIdEndsWith:function(b){return $('[id$="'+b+'"]')},contentOverlayOnShow:function(c,b){SKYVE.PF.getById(c+"_iframe").attr("src",b)},contentOverlayOnHide:function(b){SKYVE.PF.getById(b+"_iframe").attr("src","")},afterContentUpload:function(c,f,e,d){top.$('[id$="_'+c+'"]').val(f);var b="content?_n="+f+"&_doc="+e+"&_b="+c.replace(/\_/g,".");top.$('[id$="_'+c+'_link"]').attr("href",b).text(d);top.$('[id$="_'+c+'_image"]').attr("src",b);top.PF(c+"Overlay").hide()},clearContentImage:function(b){$('[id$="_'+b+'"]').val("");$('[id$="_'+b+'_image"]').attr("src","images/blank.gif")},clearContentLink:function(b){$('[id$="_'+b+'"]').val("");$('[id$="_'+b+'_link"]').attr("href","javascript:void(0)").text("<Empty>")},getTextElement:function(b){return SKYVE.PF.getById(b)},getTextValue:function(b){return SKYVE.PF.getTextElement(b).val()},setTextValue:function(c,b){SKYVE.PF.getTextElement(c).val(b)},getPasswordElement:function(b){return SKYVE.PF.getById(b+"password")},getPasswordValue:function(b){return SKYVE.PF.getPasswordElement(b).val()},setPasswordValue:function(c,b){SKYVE.PF.getPasswordElement(c).val(b)},getComboElement:function(b){return SKYVE.PF.getById(b)},getLookupElement:function(b){return SKYVE.PF.getById(b)},getLookupValue:function(b){return SKYVE.PF.getById(b+"_hinput").val()},setLookupValue:function(c,b){SKYVE.PF.getById(c+"_hinput").val(b)},getLookupDescription:function(b){return SKYVE.PF.getById(b+"_input").val()},setLookupDescription:function(c,b){SKYVE.PF.getById(c+"_input").val(b)},getCheckboxElement:function(b){return SKYVE.PF.getById(b)},getCheckboxValue:function(c){var b=SKYVE.PF.getById(c+"_input").val();if(b=="0"){return null}else{if(b=="1"){return true}else{if(b=="2"){return false}else{return SKYVE.PF.getById(c+"_input").is(":checked")}}}},setCheckboxValue:function(f,b){SKYVE.PF.getById(f+"_input").prop("checked",b);var e=SKYVE.PF.getById(f);var d=e.find(".ui-chkbox-box");var c=d.find(".ui-chkbox-icon");if(b){d.addClass("ui-state-active");c.addClass("ui-icon ui-icon-check")}else{d.removeClass("ui-state-active");c.removeClass("ui-icon ui-icon-check")}},toggleFilters:function(b){var e="hiddenFilter";var d=$('[id$="'+b+'"]');if(d!=null){var c=function(){var f=$(this);if(f.hasClass(e)){f.removeClass(e)}else{f.addClass(e)}};d.find(".ui-filter-column").each(c);d.find(".ui-column-customfilter").each(c)}},onPushMessage:function(d){var f=[];for(var e=0,c=d.length;e<c;e++){var b=d[e];if(b.type=="g"){f.push({severity:b.severity,summary:b.message})}else{if(b.type=="m"){alert(b.message)}else{if(b.type=="r"){pushRerender()}else{if(b.type=="j"){window[b.method](b.argument)}}}}}if(f.length>0){PrimeFaces.cw("Growl","pushGrowl",{id:"pushGrowl",widgetVar:"pushGrowl",life:6000,sticky:false,msgs:f})}},gmap:function(b){if(a){setTimeout(function(){SKYVE.PF.gmap(b)},100)}else{if(window.google&&window.google.maps&&window.SKYVE.BizMapPicker){if(b.queryName||b.modelName){return SKYVE.BizMap.create(b)}return SKYVE.BizMapPicker.create(b)}else{a=true;SKYVE.Util.loadJS("wicket/wicket.js?v="+SKYVE.Util.v,function(){SKYVE.Util.loadJS("wicket/wicket-gmap3.js?v="+SKYVE.Util.v,function(){var c="https://maps.googleapis.com/maps/api/js?v=3&libraries=drawing";if(SKYVE.Util.googleMapsV3ApiKey){c+="&key="+SKYVE.Util.googleMapsV3ApiKey}SKYVE.Util.loadJS(c,function(){SKYVE.Util.loadJS("prime/skyve-gmap-min.js?v="+SKYVE.Util.v,function(){a=false;if(b.queryName||b.modelName){return SKYVE.BizMap.create(b)}return SKYVE.BizMapPicker.create(b)})})})})}}}}}();