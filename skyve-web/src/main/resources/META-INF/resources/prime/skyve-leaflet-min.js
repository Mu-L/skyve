SKYVE.BizMap=function(){var a={};var b=function(g,d){if(g._refreshing){return}g._refreshing=true;var f="";if(g.loading==="lazy"){var e=g.webmap.wrapLatLngBounds(g.webmap.getBounds());var c=e.getNorthEast();f="&_ne=POINT("+c.lng+" "+c.lat+")";c=e.getSouthWest();f+="&_sw=POINT("+c.lng+" "+c.lat+")"}$.get(g.url+f,function(h){try{SKYVE.Leaflet.scatter(g,h,d,true)}finally{g._refreshing=false}})};return{create:function(e){var d={zoom:1,center:[0,0],fullscreenControl:{pseudoFullscreen:false},layers:[L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19})]};var j=a[e.elementId];if(j){if(j.webmap){d.zoom=j.webmap.getZoom();d.center=j.webmap.getCenter()}if(j._intervalId){clearInterval(j._intervalId);j._intervalId=null}}else{j={_objects:null,refreshTime:e.refreshTime,loading:e.loading,_refreshRequired:true,_refreshing:false,_intervalId:null,click:function(k){return SKYVE.BizMap.click(this,k)},rerender:function(){b(this,false)},moduleName:e.moduleName,queryName:e.queryName,geometryBinding:e.geometryBinding,documentName:e.documentName,modelName:e.modelName};a[e.elementId]=j}var i=false;if(j.documentName){var f=j.moduleName+"_"+j.documentName+"_"+j.modelName;var h=sessionStorage.getItem(f);if(h){i=true;var g=JSON.parse(h);d.center=g.centre;d.zoom=g.zoom;sessionStorage.removeItem(f)}}else{var f=j.moduleName+"_"+j.queryName+"_"+j.geometryBinding;var h=sessionStorage.getItem(f);if(h){i=true;var g=JSON.parse(h);d.center=g.centre;d.zoom=g.zoom;sessionStorage.removeItem(f)}}j._objects={};j.webmap=L.map(SKYVE.PF.getByIdEndsWith(e.elementId)[0],d);if(e.showRefresh){SKYVE.Leaflet.refreshControls(j)}if(e.loading==="lazy"){j.webmap.on("zoomend",function(k){if(!j._refreshing){b(j,false)}});j.webmap.on("moveend",function(k){b(j,false)})}var c=SKYVE.Util.CONTEXT_URL+"map?";if(e.modelName){c+="_c="+e._c+"&_m="+e.modelName}else{if(e.queryName){c+="_mod="+e.moduleName+"&_q="+e.queryName+"&_geo="+e.geometryBinding}}j.url=c;b(j,(!i));if((j.refreshTime>0)&&j._refreshRequired){j._intervalId=setInterval(j.rerender.bind(j),j.refreshTime*1000)}return j},get:function(c){return a[c]},click:function(e,d){if(e.documentName){sessionStorage.setItem(e.moduleName+"_"+e.documentName+"_"+e.modelName,'{"centre":'+JSON.stringify(e.webmap.getCenter())+',"zoom":'+e.webmap.getZoom()+"}")}else{sessionStorage.setItem(e.moduleName+"_"+e.queryName+"_"+e.geometryBinding,'{"centre":'+JSON.stringify(e.webmap.getCenter())+',"zoom":'+e.webmap.getZoom()+"}")}var c=d.zoomData.infoMarkup;c+='<br/><br/><input type="button" value="Zoom" onclick="window.location=\''+SKYVE.Util.CONTEXT_URL;c+="?m="+d.zoomData.mod+"&d="+d.zoomData.doc+"&i="+d.zoomData.bizId+"'\"/>";return c}}}();SKYVE.BizMapPicker=function(){var a={};return{create:function(e){var d={zoom:SKYVE.Util.mapZoom,center:SKYVE.Leaflet.centre(),editable:true,fullscreenControl:{pseudoFullscreen:false},layers:[L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19})]};var f=a[e.elementId];if(f){if(f.webmap){d.zoom=f.webmap.getZoom();d.center=f.webmap.getCenter()}}else{f={_overlays:[],setFieldValue:function(g){var h=SKYVE.PF.getTextElement(c+"_value");h.val(g);h.change()}};a[e.elementId]=f}var c=SKYVE.PF.getByIdEndsWith(e.elementId).attr("id");f.webmap=L.map(document.getElementById(c),d);if(!e.disabled){SKYVE.Leaflet.drawingTools(f);SKYVE.Leaflet.geoLocator(f)}SKYVE.Leaflet.clear(f);var b=SKYVE.PF.getTextElement(c+"_value");b.attr("readonly",true);SKYVE.Leaflet.scatterValue(f,b.val())}}}();